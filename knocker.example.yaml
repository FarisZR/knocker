# knocker.example.yaml

server:
  host: "0.0.0.0"
  port: 8000
  trusted_proxies:
    # Trust the default Docker IPv4 and IPv6 subnets.
    # Adjust these to match your specific Docker network configuration.
    - "172.29.238.0/24"
    - "fd00:dead:c0de::/64"

cors:
  allowed_origin: "*"  # SECURITY: Set to your web app's origin (e.g., "https://your-web-app.com") in production instead of "*"

security:
  always_allowed_ips:
    # These IPs/CIDRs are always allowed to pass through the /verify endpoint
    # without needing to be dynamically whitelisted.
    # It's recommended to include your reverse proxy's IP here.
    - "172.29.238.0/24"
    - "fd00:dead:c0de::/64"
  excluded_paths:
    # Request paths that start with any of these values will bypass
    # the IP whitelist check entirely.
    # Example:
    # - "/api/v1/status"
    # - "/metrics"
    - "/knock"
  # Maximum number of entries in the whitelist (default: 10000)
  max_whitelist_entries: 10000

whitelist:
  # The path where the whitelist file will be stored.
  # This path is relative to the container's file system.
  # The docker-compose.yml file will mount a volume to this location.
  storage_path: "/data/whitelist.json"

# Firewalld integration for advanced firewall control
firewalld:
  enabled: false  # Set to true to enable firewalld integration
  zone_name: "knocker"  # Name of the firewalld zone to create, WON"T BE CLEANED UP AUTOMATICALLY ON SHUTDOWN
  zone_priority: -100  # Zone priority (negative numbers = higher priority, default: -100)
  default_action: "drop"  # Default action for blocked traffic: "drop" or "reject"
  monitored_ports:
    # Ports that will be protected by knocker firewall rules
    # Only whitelisted IPs will be able to access these ports
    - port: 80
      protocol: tcp
    - port: 443
      protocol: tcp
    - port: 22
      protocol: tcp
  monitored_ips:
    # CAUTION: Using 0.0.0.0 or ::/0 applies DROP-by-default to ALL sources at high priority.
    # Start narrowly (e.g., your WAN subnet) and expand only if you fully understand the impact.
    # Examples:
    # - "203.0.113.0/24"   # WAN IPv4
    # - "2001:db8:1234::/48"  # WAN IPv6
    - "203.0.113.0/24"
    - "2001:db8:1234::/48"
  # NOTE: Enabling firewalld requires the container to run as root
  # and requires system dbus access. See documentation for setup details.

api_keys:
  - name: "admin-key-for-remote-whitelisting"
    key: "CHANGE_ME_SUPER_SECRET_ADMIN_KEY"
    max_ttl: 3600 # Whitelist IPs for a maximum of 1 hour (in seconds)
    allow_remote_whitelist: true # This key CAN whitelist other IPs/CIDRs

  - name: "personal-phone"
    key: "CHANGE_ME_SECRET_PHONE_KEY"
    max_ttl: 14400 # Whitelist IPs for a maximum of 4 hours
    allow_remote_whitelist: false # This key can ONLY whitelist its own IP

  - name: "guest-access"
    key: "CHANGE_ME_TEMPORARY_GUEST_KEY"
    max_ttl: 600 # Whitelist IPs for a maximum of 10 minutes
    allow_remote_whitelist: false